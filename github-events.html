<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/core-ajax/core-ajax.html">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="bower_components/core-icon/core-icon.html">
<!--
Element providing solution to no problem in particular.

##### Example

<github-events></github-events>

@element github-events
@blurb Element providing solution to no problem in particular.
@status alpha
@homepage http://Mortega5.github.io/github-events
-->
<polymer-element name="github-events" attributes="mostrar username token">
	<template>
		<link rel="stylesheet" href="github-events.css">
		<core-ajax id="request"
				   method="GET"
				   url="https://api.github.com/users/{{username}}/received_events"
				   params='{"page":"{{page}}","per_page":"{{mostrar}}"}'
				   handleAs="json"
				   on-core-response="{{response}}"
				   ></core-ajax>
		</core-ajax>
	<paper-shadow z=2>
		<core-icon src="foto.png" style="width: 100px;height: 50px;display:inline-block;float:left"></core-icon>
		<div id ="cabecera">
			<p style="text-align:center">Últimos eventos</p>
		</div>
		<template if="{{show}}">
			<ul class="box" style="border-bottom: 5px solid #d0d0d0;cursor:wait;text-align:center">
				<p>Loading...</p>
			</ul>
		</template>
		<div style="overflow-y: scroll;max-height: 400px" id="scrollControl">
			<template id="contenido" is="auto-binding" repeat="{{events}}">
				<ul class="box">
					<div style="text-align: center">
						<core-icon  src="{{actor.avatar_url}}" class="imgEvent">
						</core-icon>
						<span class="name" >{{actor.login}}</span>
					</div>
					</br>
				<p>{{type}} sobre <a href="https://github.com/{{repo.name}}"><span style="font-style: italic">{{repo.name}}</span></a></p>
				<p>{{payload.commits[0].message}}</p>
				</ul>
			</template>
		<template if={{!show}}>
			<ul class="box" style="text-align:center;cursor: pointer;font-size: 16px;">
				<span on-click={{load}}>Cargar Más</span>
			</ul>
		</template>
		</div>
	</paper-shadow>
</template>
<script>
	Polymer({
		mostrar: 15,
		username:'',
		token:'',
		events:'',
		maxPage:'',
		show:true,
		page:'1',
		ready: function () {
			if (this.token != '') {
				this.$.request.headers = '{"Authorization":"token '+this.token+'"}';
			}
			this.$.request.go();
			var scroll = this.$.scrollControl;
			var element = this;
			scroll.onscroll = function(){
				if (((scroll.scrollTop+scroll.clientHeight)*100/scroll.scrollHeight)>85){
						element.load();
				}
			};
		},

		response: function(event,detail,sender){
			this.events = sender.response;
			var t = this.$.contenido;
			if (t.events == undefined) 
				t.events = this.events;
			else
				t.events = 	t.events.concat(this.events);
			this.show = false;
			this.page++;
		},
		load: function(){
			this.$.request.go();	
		},
	});
</script>
</polymer-element>
